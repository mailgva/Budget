<html xmlns:th="http://www.thymeleaf.org" xmlns:ht="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head">
</head>
<body>
<div th:replace="fragments/bodyHeader :: div">
</div>
<main role="main">
    <div class="jumbotron" style="background: #c2ff8e">
        <div class="form-group ">
            <a href="/budget/create/profit" class="btn btn-success" role="button" aria-pressed="true"><i
                    class="fa fa-plus"></i> Создать приход</a>
            <a href="/budget/create/spending" class="btn btn-primary" role="button" aria-pressed="true"><i
                    class="fa fa-minus"></i> Создать расход</a>
        </div>

        <div class="card bg-warning">
            <div class="card-body ">

                <div class="form-group  ">
                    <!--/*--><!--@thymesVar id="kind" type="com.gorbatenko.budget.model.Kind"-->
                    <!--*/-->
                    <!--/*--><!--@thymesVar id="budget" type="com.gorbatenko.budget.model.Type"-->
                    <!--*/-->
                    <form th:action="@{/budget/statistic}" method="get">
                        <div class="form-group row">

                            <div class="col-2">
                                <label for="startDate">Дата начала</label>
                                <input class="form-control" name="startDate" id="startDate"
                                       type="date"
                                       th:value="${startDate}">
                            </div>


                            <div class="col-2">
                                <label for="endDate">Дата конца</label>
                                <input class="form-control" name="endDate" id="endDate"
                                       type="date"
                                       th:value="${endDate}">
                            </div>


                            <div class="col-2">
                                <label for="type">Тип</label>
                                <select id="type" name="type" class="form-control">
                                    <option th:value="allTypes"> Все</option>
                                    <option
                                        th:each="val : ${T(com.gorbatenko.budget.model.Type).values()}"
                                        th:value="${val}"
                                        th:text="${val.value}"
                                        th:selected="${val.value.equalsIgnoreCase(typeName)}">
                                    </option>
                                </select>
                            </div>


                            <div class="col-3">
                                <label for="kindId">Вид</label>
                                <select id="kindId" name="kindId" class="form-control">
                                    <option th:value="-1"> Все</option>
                                    <option th:each="kind : ${kindList}"
                                            th:value="${kind.id}"
                                            th:text="${kind.type.getValue() + ' / ' + kind.name}"
                                            th:selected="${kind.getName().equalsIgnoreCase(kindName)}">
                                    </option>
                                </select>
                            </div>

                            <div class="col-2">
                                <label for="comment">Описание</label>
                                <input class="form-control" name="comment" id="comment"
                                       type="text"
                                       th:value="${comment}">
                            </div>

                            <div class="form-group col-1 flex-bottom">
                                <button id="btnsub" type="submit" class="btn btn-dark">
                                    <i class="fa fa-filter"></i>
                                </button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>

        <table th:replace="fragments/statHeader :: table">
        </table>
        <div style="width: 98%" class="form-check" align="right">
            <input type="checkbox" class="form-check-input" id="check-hide" onclick="hide_alldetail(this);">
            <label class="form-check-label" for="check-hide">Cкрыть детали</label>
        </div>
        <!--/*--><!--@thymesVar id="listBudget" type="java.util.TreeMap"--><!--*/-->
        <table class="table">
            <tbody>
            <tr th:if="${listBudget.isEmpty()}">
                <td colspan="7"> Бюджет не доступен</td>
            </tr>

            <th:block th:each="element : ${listBudget}">
                <tr class="bg-warning" onclick="hide_detail(this);">
                    <td colspan="7">
                        <h4 style="display:inline-block; width : 35%" th:text="${#temporals.format(element.key, 'dd-MM-yyyy') + ' - ' + #temporals.dayOfWeekName(element.key)}"> Date </h4>
                        <div style="display:inline-block;font-weight: bold; width : 60%;" align="right">
                            <div style="display:inline-block; width: 140px;" align="left"> Приход: <b>
                                <span th:text="*{#aggregates.sum(element.value.![(kind.getType().name().equals('PROFIT') ? price : 0)])}"></span></b>
                            </div>

                            <div style="display:inline-block; width: 140px;" align="left"> Расход: <b>
                                <span th:text="*{#aggregates.sum(element.value.![(kind.getType().name().equals('PROFIT') ? 0 : price)])}"></span></b>
                            </div>

                            <div style="display:inline-block; width: 140px" align="left"> Итог: <b>
                                <span th:text="*{#aggregates.sum(element.value.![(kind.getType().name().equals('PROFIT') ? price : -price)])}"></span></b>
                            </div>
                        </div>
                    </td>
                </tr>


                <tr class="border border-warning budget_detail">
                    <td colspan="7">
                        <table class="table table-active ">
                            <thead>
                            <tr class="table-active">
                                <th style="width: 5%"> #</th>
                                <th style="width: 15%"> Пользователь</th>
                                <th style="width: 10%"> Операция</th>
                                <th style="width: 20%"> Вид</th>
                                <th style="width: 20%"> Описание</th>
                                <th style="width: 10%"> Сумма</th>
                                <th style="width: 5%"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <!--/*--><!--@thymesVar id="budget" type="com.gorbatenko.budget.model.Budget"--><!--*/-->
                            <th:block th:each="budget,row : ${element.value}">

                                <tr th:class="${budget.kind.getType().name().equals('PROFIT')  ? 'bg-success' : 'bg-info'}">
                                    <td style="width: 5%"><span th:text="${row.index+1}"> # </span></td>
                                    <td style="width: 15%"><span th:text="${budget.user.name}"> User </span></td>
                                    <td style="width: 10%"><span
                                            th:text="${budget.kind.getType().getValue()}"> Type </span>
                                    </td>
                                    <td style="width: 20%"><span th:text="${budget.kind.name}"> Item </span></td>
                                    <td style="width: 20%"><span th:text="${budget.description}"> Description </span>
                                    </td>
                                    <td style="width: 10%"><span th:text="${budget.price}"> Price </span></td>
                                    <td style="width: 5%">
                                        <a th:href="@{'/budget/edit/'+${budget.id}}" class="btn btn-warning" role="button"
                                           aria-pressed="true"><i
                                                class="fa fa-pencil"></i></a>
                                    </td>
                                </tr>
                            </th:block>
                        </table>
                    </td>
                </tr>
            </th:block>
            <tbody>
        </table>

    </div>
</main>
<script>
    function hide_detail(elm) {
        var tr = $(elm).closest('tr').next('tr')[0];
        tr.style.display = (tr.style.display == 'none') ? '' : 'none';
    }

    function hide_alldetail(elm) {
        $('tr.budget_detail').css('display', ($(elm).is(':checked') ? 'none' : ''));
    }
</script>
</body>
</html>