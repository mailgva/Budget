<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head">
</head>
<body>
<div th:replace="fragments/bodyHeader :: div">
</div>
<main role="main">
    <div class="jumbotron" style="background: #c2ff8e">
        <div class="col-sm-8 mx-auto">
            <!--/*--><!--@thymesVar id="budget" type="com.gorbatenko.budget.model.Kind"--><!--*/-->
            <h2 th:text="'Добавление статьи ' + ${type.getValue()}"> </h2>

            <form id="form" name="form" th:action="@{/budget/}" method="post">
                <div class="form-group">
                    <label for="kindId">Вид</label>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <button class="btn btn-outline-secondary" type="button"
                                    onclick="location.href = 'dictionaries/kinds/create';">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                        <select id="kindId" name="kindId" class="custom-select">
                            <option th:each="kind : ${kinds}"
                                    th:value="${kind.id}"
                                    th:text="${kind.name}"></option>
                        </select>
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button"
                                    onclick="sortKinds()"><i class="fa fa-sort-alpha-asc"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="date">Дата</label>
                    <input type="date" name="date" id="date" class="form-control" th:value="${date}">
                </div>
                <div class="form-group">
                    <label for="description">Описание</label>
                    <input type="text" name="description" id="description" class="form-control" placeholder="Описание"  onkeyup="calculate(this)">
                </div>
                <div class="form-check">
                    <input type="checkbox" name="autocalc" class="form-check-input" id="autocalc" checked>
                    <label class="form-check-label" for="autocalc">Автоматический подсчет</label>
                </div>
                <div class="form-group">
                    <label for="price">Сумма</label>
                    <div class="input-group mb-3">
                        <input type="number" min="1" step="0.5" name="price" id="price"
                               class="form-control" placeholder="Сумма" required>
                        <div class="input-group-append">
                            <!--/*--><!--@thymesVar id="currency" type="com.gorbatenko.budget.model.Currency"--><!--*/-->
                            <select id="currencyId" name="currencyId" class="custom-select" style="width: 80px;">
                                <option th:each="currency : ${currencies}"
                                        th:value="${currency.id}"
                                        th:text="${currency.name}"
                                        th:selected="${currency.id.equals(defaultCurrency.getId())}"
                                ></option>
                            </select>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" name="submit" type="submit"><i class="fa fa-save"></i> Сохранить</button>
            </form>
        </div>
    </div>
</main>
<script>
    function calculate(input){
        if (!$('#autocalc').is(":checked")) return;
        var str = input.value;
        str = str.replace(/[^\.0-9]/g, " ");
        var arr = str.split(" ");
        var result = 0.0;
        arr.forEach(function(item) {
            result+= ((item.replace(" ","") === "") ? 0.0 : parseFloat(item));
        });
        if(result > 0) {
            $('#price').val(result);
        };
    }

    function sortKinds() {
        var c = document.getElementById('kindId');
        var options = c.options;
        Array.prototype.sort.call(options, function (a, b) {
            var aText = a.text.toLowerCase();
            var bText = b.text.toLowerCase();
            if (aText < bText) {
                return -1;
            } else if (aText > bText) {
                return 1;
            } else {
                return 0;
            }
        });
    }
</script>
</body>
</html>